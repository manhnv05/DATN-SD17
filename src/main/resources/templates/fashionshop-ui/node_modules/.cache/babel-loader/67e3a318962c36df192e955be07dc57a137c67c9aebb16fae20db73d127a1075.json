{"ast":null,"code":"var _jsxFileName = \"D:\\\\fashion-shirt-shop\\\\DATN\\\\src\\\\main\\\\resources\\\\templates\\\\fashionshop-ui\\\\src\\\\layouts\\\\admin\\\\BanHangTaiQuay\\\\component\\\\Pay.jsx\",\n  _s = $RefreshSig$();\n// src/layouts/BanHangTaiQuay/component/Pay.jsx\n\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport { Box, Typography, Divider, TextField, Switch, FormControlLabel, Grid, Dialog, DialogTitle, DialogContent, IconButton } from \"@mui/material\";\nimport axios from \"axios\";\n\n// Import components v√† icons\nimport SoftBox from \"../../../../components/SoftBox\";\nimport SoftTypography from \"../../../../components/SoftTypography\";\nimport SoftButton from \"../../../../components/SoftButton\";\nimport Card from \"@mui/material/Card\";\nimport PersonSearchIcon from \"@mui/icons-material/PersonSearch\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport PropTypes from \"prop-types\";\n// Import c√°c component con\nimport ShippingForm from \"./ShippingForm\";\nimport CustomerTable from \"./CustomerTable\";\nimport AddressSelectionModal from \"./AddressSelectionModal\";\nimport AddAddressModal from \"./AddAddressModal\";\nimport PaymentModal from \"./PaymentModal\";\nimport CalculateIcon from \"@mui/icons-material/Calculate\";\nimport { InputAdornment } from \"@mui/material\";\nimport { toast } from \"react-toastify\";\nimport InHoaDon from \"../../HoaDon/InHoaDon/InHoaDon\";\nimport PaymentIcon from \"@mui/icons-material/Payment\";\n// H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst formatCurrency = amount => {\n  if (typeof amount !== \"number\" || isNaN(amount)) return \"0 VND\";\n  return new Intl.NumberFormat(\"vi-VN\", {\n    style: \"currency\",\n    currency: \"VND\"\n  }).format(amount);\n};\nconst formatNumber = value => {\n  if (!value) return \"\";\n  return new Intl.NumberFormat(\"vi-VN\").format(value);\n};\nfunction Pay({\n  totalAmount,\n  hoaDonId,\n  onSaveOrder,\n  onDataChange,\n  completedOrderId\n}) {\n  _s();\n  const hoaDonDataRef = useRef({});\n  const [isDelivery, setIsDelivery] = useState(false);\n  const [shippingFee, setShippingFee] = useState(0);\n  const [discountValue, setDiscountValue] = useState(0);\n  const [paymentDetails, setPaymentDetails] = useState([]);\n  const [shippingFeeInput, setShippingFeeInput] = useState(\"0\");\n  const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\n  const [voucherCode, setVoucherCode] = useState(\"\");\n  const [appliedVoucher, setAppliedVoucher] = useState(null);\n  const [suggestedVoucher, setSuggestedVoucher] = useState(null);\n  const [bestidVoucher, setBestidVoucher] = useState(null);\n  const [customer, setCustomer] = useState({\n    id: null,\n    tenKhachHang: \"Kh√°ch l·∫ª\"\n  });\n  const [isCustomerModalOpen, setIsCustomerModalOpen] = useState(false);\n  const [shippingFormData, setShippingFormData] = useState(null);\n  const [shippingAddress, setShippingAddress] = useState(null);\n  const finalTotal = totalAmount + (isDelivery ? shippingFee : 0) - discountValue;\n  const amountOwed = finalTotal - Number(customer || 0);\n  const [isAddressModalOpen, setIsAddressModalOpen] = useState(false);\n  const [addressList, setAddressList] = useState([]);\n  const [isAddAddressModalOpen, setIsAddAddressModalOpen] = useState(false);\n  const [isCalculatingFee, setIsCalculatingFee] = useState(false);\n  // T√≠nh to√°n ti·ªÅn d·ª±a tr√™n `paymentDetails`\n  const totalPaid = paymentDetails.reduce((sum, p) => sum + p.soTienThanhToan, 0);\n  const changeToCustomer = totalPaid - finalTotal;\n  const [isInvoiceModalOpen, setIsInvoiceModalOpen] = useState(false);\n  const [invoiceToPrintId, setInvoiceToPrintId] = useState(null);\n  const GHN_API_BASE_URL = \"https://online-gateway.ghn.vn/shiip/public-api\";\n  const GHN_TOKEN = \"03b71be1-6891-11f0-9e03-7626358ab3e0\";\n  const ghnApi = axios.create({\n    baseURL: GHN_API_BASE_URL,\n    headers: {\n      token: GHN_TOKEN,\n      \"Content-Type\": \"application/json\"\n    }\n  });\n  const getShippingFeeFromGHN = async shippingInfo => {\n    const shop_id = 5908591;\n    const {\n      districtId: to_district_id,\n      wardCode: to_ward_code\n    } = shippingInfo;\n    if (!to_district_id || !to_ward_code) {\n      return 0;\n    }\n\n    // üî• GI·∫¢I PH√ÅP: Th·ª≠ nhi·ªÅu district kh√°c nhau trong H√† N·ªôi\n    const alternativeDistricts = [\n    // Th·ª≠ district g·ªëc tr∆∞·ªõc\n    {\n      district_id: 1450,\n      ward_code: \"217010\",\n      name: \"C·∫ßu Gi·∫•y (G·ªëc)\"\n    },\n    // Backup districts\n    {\n      district_id: 1442,\n      ward_code: \"21211\",\n      name: \"Ba ƒê√¨nh\"\n    }, {\n      district_id: 1443,\n      ward_code: \"21311\",\n      name: \"Ho√†n Ki·∫øm\"\n    }, {\n      district_id: 1447,\n      ward_code: \"21711\",\n      name: \"ƒê·ªëng ƒêa\"\n    }, {\n      district_id: 1448,\n      ward_code: \"21811\",\n      name: \"Hai B√† Tr∆∞ng\"\n    }, {\n      district_id: 1451,\n      ward_code: \"22111\",\n      name: \"Thanh Xu√¢n\"\n    }];\n\n    // Th·ª≠ t·ª´ng district cho ƒë·∫øn khi th√†nh c√¥ng\n    for (const altDistrict of alternativeDistricts) {\n      const from_district_id = altDistrict.district_id;\n      const from_ward_code = altDistrict.ward_code;\n      console.log(`üîÑ ƒêang th·ª≠: ${altDistrict.name} (${from_district_id})`);\n      try {\n        var _serviceResponse$data, _feeResponse$data;\n        // B∆∞·ªõc 1: Ki·ªÉm tra d·ªãch v·ª• kh·∫£ d·ª•ng\n        const serviceResponse = await axios.get(`${GHN_API_BASE_URL}/v2/shipping-order/available-services`, {\n          params: {\n            shop_id: shop_id,\n            from_district: from_district_id,\n            to_district: to_district_id\n          },\n          headers: {\n            token: GHN_TOKEN,\n            \"Content-Type\": \"application/json\"\n          }\n        });\n        if (!((_serviceResponse$data = serviceResponse.data) !== null && _serviceResponse$data !== void 0 && _serviceResponse$data.data) || serviceResponse.data.data.length === 0) {\n          console.log(`‚ùå Kh√¥ng c√≥ d·ªãch v·ª• cho ${altDistrict.name}`);\n          continue;\n        }\n\n        // B∆∞·ªõc 2: T√≠nh ph√≠ v·∫≠n chuy·ªÉn\n        const selectedService = serviceResponse.data.data[0];\n        const service_id = selectedService.service_id;\n        const service_type_id = selectedService.service_type_id;\n        const feePayload = {\n          service_id: service_id,\n          service_type_id: service_type_id,\n          from_district_id: from_district_id,\n          from_ward_code: from_ward_code,\n          to_district_id: to_district_id,\n          to_ward_code: to_ward_code,\n          height: 20,\n          length: 30,\n          weight: 500,\n          width: 15,\n          insurance_value: 0,\n          coupon: null,\n          cod_failed_amount: 0\n        };\n        const feeResponse = await axios.post(`${GHN_API_BASE_URL}/v2/shipping-order/fee`, feePayload, {\n          headers: {\n            token: GHN_TOKEN,\n            ShopId: shop_id,\n            \"Content-Type\": \"application/json\"\n          }\n        });\n        if (((_feeResponse$data = feeResponse.data) === null || _feeResponse$data === void 0 ? void 0 : _feeResponse$data.code) === 200) {\n          console.log(`‚úÖ Th√†nh c√¥ng v·ªõi ${altDistrict.name}!`);\n          console.log(`üí∞ Ph√≠ v·∫≠n chuy·ªÉn: ${feeResponse.data.data.total} VND`);\n\n          // Th√¥ng b√°o cho user bi·∫øt ƒëang d√πng ƒë·ªãa ch·ªâ backup (n·∫øu kh√¥ng ph·∫£i district g·ªëc)\n          if (from_district_id !== 1450) {\n            // toast.info(`ƒêang s·ª≠ d·ª•ng ƒëi·ªÉm g·ª≠i t·∫°i ${altDistrict.name} ƒë·ªÉ t√≠nh ph√≠ v·∫≠n chuy·ªÉn.`);\n          }\n          return feeResponse.data.data.total;\n        }\n      } catch (error) {\n        var _error$response, _error$response$data;\n        const errorCode = (_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.code_message;\n        console.log(`‚ùå L·ªói v·ªõi ${altDistrict.name}: ${errorCode}`);\n\n        // N·∫øu kh√¥ng ph·∫£i l·ªói district invalid th√¨ d·ª´ng (c√≥ th·ªÉ l·ªói kh√°c)\n        if (errorCode !== \"SEND_DISTRICT_IS_INVALID\") {\n          var _error$response2;\n          console.error(\"L·ªói kh√¥ng ph·∫£i district invalid:\", (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data);\n          break;\n        }\n        continue;\n      }\n    }\n\n    // üéØ FALLBACK: N·∫øu t·∫•t c·∫£ districts ƒë·ªÅu fail, d√πng ph√≠ ∆∞·ªõc t√≠nh\n    console.log(\"üîÑ T·∫•t c·∫£ districts ƒë·ªÅu fail, s·ª≠ d·ª•ng ph√≠ ∆∞·ªõc t√≠nh\");\n    const estimatedFee = getEstimatedShippingFee(to_district_id);\n    toast.warning(`Kh√¥ng th·ªÉ t√≠nh ph√≠ ch√≠nh x√°c. S·ª≠ d·ª•ng ph√≠ ∆∞·ªõc t√≠nh: ${formatCurrency(estimatedFee)}`);\n    return estimatedFee;\n  };\n\n  // H√†m t√≠nh ph√≠ ∆∞·ªõc t√≠nh d·ª±a tr√™n district ƒë√≠ch\n  const getEstimatedShippingFee = to_district_id => {\n    // Ph√≠ ∆∞·ªõc t√≠nh d·ª±a tr√™n kho·∫£ng c√°ch (c√≥ th·ªÉ customize)\n    const feeRanges = {\n      // N·ªôi th√†nh H√† N·ªôi (1442-1465)\n      hanoi_inner: 25000,\n      // Ngo·∫°i th√†nh H√† N·ªôi (1466-1490)\n      hanoi_outer: 35000,\n      // TP.HCM v√† c√°c th√†nh ph·ªë l·ªõn\n      major_cities: 45000,\n      // C√°c t·ªânh kh√°c\n      other_provinces: 55000\n    };\n    if (to_district_id >= 1442 && to_district_id <= 1465) {\n      return feeRanges.hanoi_inner;\n    } else if (to_district_id >= 1466 && to_district_id <= 1490) {\n      return feeRanges.hanoi_outer;\n    } else if (to_district_id >= 1460 && to_district_id <= 1520) {\n      return feeRanges.major_cities;\n    } else {\n      return feeRanges.other_provinces;\n    }\n  };\n  // H√†m l∆∞u d·ªØ li·ªáu hi·ªán t·∫°i v√†o ref\n  const saveCurrentData = useCallback(() => {\n    if (hoaDonId) {\n      hoaDonDataRef.current[hoaDonId] = {\n        isDelivery,\n        shippingFee,\n        shippingFeeInput,\n        discountValue,\n        voucherCode,\n        appliedVoucher,\n        suggestedVoucher,\n        customer,\n        shippingFormData,\n        shippingAddress,\n        paymentDetails\n      };\n    }\n  }, [hoaDonId, isDelivery, shippingFee, discountValue, voucherCode, shippingFeeInput, appliedVoucher, suggestedVoucher, customer, shippingFormData, shippingAddress, paymentDetails]);\n  useEffect(() => {\n    if (completedOrderId) {\n      const orderToClose = orders.find(o => o.idHoaDonBackend === completedOrderId);\n      if (orderToClose) {\n        handleCloseOrderTab(orderToClose.id);\n      }\n    }\n  }, [completedOrderId]);\n  const restoreData = useCallback(() => {\n    if (hoaDonId && hoaDonDataRef.current[hoaDonId]) {\n      const savedData = hoaDonDataRef.current[hoaDonId];\n      setIsDelivery(savedData.isDelivery);\n      setShippingFee(savedData.shippingFee);\n      setDiscountValue(savedData.discountValue);\n      setShippingFeeInput(savedData.shippingFeeInput || \"0\");\n      setVoucherCode(savedData.voucherCode);\n      setAppliedVoucher(savedData.appliedVoucher);\n      setSuggestedVoucher(savedData.suggestedVoucher);\n      setCustomer(savedData.customer);\n      setShippingFormData(savedData.shippingFormData);\n      setShippingAddress(savedData.shippingAddress);\n      setPaymentDetails(savedData.paymentDetails || []);\n    } else {\n      // Reset v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥ d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u\n      resetToDefault();\n\n      // Sau khi reset, g·ªçi API t√¨m voucher t·ªët nh·∫•t cho kh√°ch l·∫ª\n      if (totalAmount > 0) {\n        fetchBestVoucherForCustomer(null);\n      }\n    }\n  }, [hoaDonId, totalAmount]);\n  const resetToDefault = useCallback(() => {\n    setIsDelivery(false);\n    setShippingFee(0);\n    setDiscountValue(0);\n    setShippingFeeInput(\"0\");\n    setPaymentDetails([]);\n    setVoucherCode(\"\");\n    setAppliedVoucher(null);\n    setSuggestedVoucher(null);\n    setCustomer({\n      id: null,\n      tenKhachHang: \"Kh√°ch l·∫ª\"\n    });\n    setShippingFormData(null);\n    setShippingAddress(null);\n  }, []);\n\n  // Effect ƒë·ªÉ l∆∞u d·ªØ li·ªáu khi c√≥ thay ƒë·ªïi\n  useEffect(() => {\n    saveCurrentData();\n  }, [saveCurrentData]);\n\n  // Effect ƒë·ªÉ kh√¥i ph·ª•c d·ªØ li·ªáu khi chuy·ªÉn tab (hoaDonId thay ƒë·ªïi)\n  useEffect(() => {\n    if (hoaDonId) {\n      restoreData();\n    }\n  }, [hoaDonId, restoreData]);\n  // NEW FUNCTION: Handle manual input for shipping fee\n  const handleShippingFeeChange = event => {\n    const rawValue = event.target.value;\n    // Allow user to type, update the input state\n    setShippingFeeInput(rawValue);\n    // Parse the number from input and update the actual fee state\n    const numericValue = parseInt(rawValue.replace(/[^0-9]/g, \"\"), 10) || 0;\n    setShippingFee(numericValue);\n    if (rawValue) {\n      setShippingFeeInput(formatNumber(numericValue));\n    } else {\n      setShippingFeeInput(\"\"); // Cho ph√©p x√≥a h·∫øt ƒë·ªÉ nh·∫≠p l·∫°i\n    }\n  };\n  // H√†m reset form ho√†n to√†n (c√≥ th·ªÉ d√πng khi c·∫ßn thi·∫øt)\n  const resetForm = useCallback(() => {\n    if (hoaDonId) {\n      delete hoaDonDataRef.current[hoaDonId]; // X√≥a d·ªØ li·ªáu ƒë√£ l∆∞u\n    }\n    resetToDefault();\n  }, [hoaDonId, resetToDefault]);\n  const handleOpenAddModalFromSelectModal = () => {\n    setIsAddressModalOpen(false);\n    setIsAddAddressModalOpen(true);\n  };\n  const handleDeliveryToggle = event => {\n    const isChecked = event.target.checked;\n    setIsDelivery(isChecked);\n    if (!isChecked) {\n      setShippingFormData(null);\n      setShippingAddress(null);\n      setShippingFeeInput(\"0\");\n    }\n  };\n  const handleFormChange = useCallback(formData => {\n    setShippingFormData(formData);\n  }, []);\n  useEffect(() => {\n    // Ch·ªâ t√≠nh ph√≠ khi b·∫≠t ch·∫ø ƒë·ªô giao h√†ng v√† c√≥ ƒë·ªß th√¥ng tin\n    if (isDelivery && shippingFormData && shippingFormData.wardCode) {\n      const handleFeeCalculation = async () => {\n        setIsCalculatingFee(true);\n        const fee = await getShippingFeeFromGHN(shippingFormData);\n        setShippingFee(fee);\n        setShippingFeeInput(fee.toString());\n        setIsCalculatingFee(false);\n      };\n      handleFeeCalculation();\n    }\n  }, [shippingFormData, isDelivery]);\n  useEffect(() => {\n    if (onDataChange) {\n      const dataToSend = {\n        customer,\n        isDelivery,\n        shippingFee,\n        shippingInfo: isDelivery ? shippingFormData : null,\n        phieuGiamGia: appliedVoucher,\n        tongTienGiam: discountValue\n      };\n      onDataChange(dataToSend);\n    }\n  }, [customer, isDelivery, shippingFee, shippingFormData, onDataChange, paymentDetails]);\n  const handleSelectCustomer = async selectedCustomer => {\n    setCustomer(selectedCustomer);\n\n    // Reset voucher khi thay ƒë·ªïi kh√°ch h√†ng\n    setVoucherCode(\"\");\n    setAppliedVoucher(null);\n    setSuggestedVoucher(null);\n    setDiscountValue(0);\n    try {\n      const response = await axios.get(`http://localhost:8080/diaChi/khachhang/${selectedCustomer.id}`);\n      const addresses = response.data;\n      if (addresses && addresses.length > 0) {\n        setShippingAddress(addresses[0]);\n      } else {\n        setShippingAddress(null);\n      }\n    } catch (error) {\n      console.error(\"L·ªói khi l·∫•y danh s√°ch ƒë·ªãa ch·ªâ:\", error);\n      setShippingAddress(null);\n    }\n\n    // G·ªçi API ƒë·ªÉ t√¨m phi·∫øu gi·∫£m gi√° t·ªët nh·∫•t cho kh√°ch h√†ng m·ªõi\n    if (totalAmount > 0) {\n      await fetchBestVoucherForCustomer(selectedCustomer.id);\n    }\n    setIsCustomerModalOpen(false);\n  };\n  const handleConfirmPayment = async newPaymentsFromModal => {\n    if (!newPaymentsFromModal || newPaymentsFromModal.length === 0) {\n      setIsPaymentModalOpen(false);\n      return;\n    }\n    try {\n      const savedPayments = [];\n      for (const payment of newPaymentsFromModal) {\n        const payload = {\n          ...payment,\n          idHoaDon: hoaDonId\n        };\n        const response = await axios.post(\"http://localhost:8080/chiTietThanhToan\", payload);\n        savedPayments.push(response.data.data);\n      }\n      setPaymentDetails(prevDetails => [...prevDetails, ...savedPayments]);\n      toast.success(\"Thanh toaÃÅn th√†nh c√¥ng!\");\n      setIsPaymentModalOpen(false);\n    } catch (error) {\n      console.error(\"L·ªói trong qu√° tr√¨nh thanh to√°n:\", error);\n    }\n  };\n  const handleFinalSave = async () => {\n    if (!isDelivery) {\n      const totalPaid = paymentDetails.reduce((sum, p) => sum + p.soTienThanhToan, 0);\n      if (totalPaid < finalTotal) {\n        toast.error(`Thanh to√°n ch∆∞a ƒë·ªß! Kh√°ch h√†ng c·∫ßn tr·∫£ th√™m ${formatCurrency(finalTotal - totalPaid)}. Vui l√≤ng ho√†n t·∫•t thanh to√°n.`);\n        return;\n      }\n    }\n    const latestPaymentData = {\n      customer: customer,\n      isDelivery: isDelivery,\n      shippingFee: shippingFee,\n      shippingInfo: isDelivery ? shippingFormData : null,\n      phieuGiamGia: appliedVoucher,\n      tongTienGiam: discountValue\n    };\n    console.log(\"D·ªØ li·ªáu thanh to√°n m·ªõi:\", latestPaymentData);\n    try {\n      // ƒê·ª£i cho ƒë·∫øn khi vi·ªác l∆∞u ƒë∆°n h√†ng ho√†n t·∫•t\n      await onSaveOrder(latestPaymentData);\n\n      // --- LOGIC M·ªöI ƒê·ªÇ IN H√ìA ƒê∆†N ---\n      // Ch·ªâ m·ªü modal in n·∫øu l√† thanh to√°n t·∫°i qu·∫ßy\n      if (!isDelivery) {\n        setInvoiceToPrintId(hoaDonId); // L∆∞u l·∫°i ID h√≥a ƒë∆°n v·ª´a thanh to√°n\n        setIsInvoiceModalOpen(true); // M·ªü modal in\n      }\n      resetForm();\n    } catch (error) {\n      console.error(\"L·ªói khi l∆∞u v√† in h√≥a ƒë∆°n:\", error);\n      // B·∫°n c√≥ th·ªÉ th√™m toast th√¥ng b√°o l·ªói ·ªü ƒë√¢y n·∫øu c·∫ßn\n    }\n\n    // resetForm(); // B·ªè comment d√≤ng n√†y n·∫øu mu·ªën reset sau khi l∆∞u\n  };\n  const handleClearCustomer = async () => {\n    setCustomer({\n      id: null,\n      tenKhachHang: \"Kh√°ch l·∫ª\"\n    });\n    setShippingAddress(null);\n\n    // Reset voucher khi b·ªè ch·ªçn kh√°ch h√†ng\n    setVoucherCode(\"\");\n    setAppliedVoucher(null);\n    setSuggestedVoucher(null);\n    setDiscountValue(0);\n\n    // G·ªçi API ƒë·ªÉ t√¨m phi·∫øu gi·∫£m gi√° cho kh√°ch l·∫ª (null)\n    if (totalAmount > 0) {\n      await fetchBestVoucherForCustomer(null);\n    }\n  };\n  const handleOpenAddressModal = async () => {\n    if (!customer || !customer.id) {\n      toast.warn(\"Vui l√≤ng ch·ªçn m·ªôt kh√°ch h√†ng tr∆∞·ªõc.\");\n      return;\n    }\n    try {\n      const response = await axios.get(`http://localhost:8080/diaChi/khachhang/${customer.id}`);\n      setAddressList(response.data || []);\n      setIsAddressModalOpen(true);\n    } catch (error) {\n      console.error(\"L·ªói khi l·∫•y danh s√°ch ƒë·ªãa ch·ªâ:\", error);\n      setAddressList([]);\n      setIsAddressModalOpen(true);\n    }\n  };\n  const handleSelectAddressFromModal = selectedAddress => {\n    setShippingAddress(selectedAddress);\n    setIsAddressModalOpen(false);\n  };\n  const handleAddressAdded = () => {\n    setIsAddAddressModalOpen(false);\n    handleOpenAddressModal();\n  };\n\n  // T√°ch ri√™ng h√†m fetch voucher ƒë·ªÉ t√°i s·ª≠ d·ª•ng\n  const fetchBestVoucherForCustomer = async customerId => {\n    try {\n      const requestBody = {\n        khachHang: customerId,\n        tongTienHoaDon: totalAmount\n      };\n      const response = await axios.post(\"http://localhost:8080/PhieuGiamGiaKhachHang/query\", requestBody, {\n        params: {\n          page: 0,\n          size: 999\n        }\n      });\n      const vouchers = response.data.data.content;\n      if (vouchers && vouchers.length > 0) {\n        const bestVoucher = vouchers[0];\n        setSuggestedVoucher(bestVoucher);\n        setAppliedVoucher(bestVoucher);\n        setVoucherCode(bestVoucher.maPhieuGiamGia);\n      } else {\n        setSuggestedVoucher(null);\n        setAppliedVoucher(null);\n        setVoucherCode(\"\");\n      }\n    } catch (error) {\n      console.error(\"L·ªói khi t√¨m phi·∫øu gi·∫£m gi√° g·ª£i √Ω:\", error);\n      setSuggestedVoucher(null);\n      setAppliedVoucher(null);\n      setVoucherCode(\"\");\n    }\n  };\n  useEffect(() => {\n    if (totalAmount > 0) {\n      fetchBestVoucherForCustomer(customer.id);\n    } else {\n      setSuggestedVoucher(null);\n      setAppliedVoucher(null);\n      setVoucherCode(\"\");\n    }\n  }, [totalAmount, customer === null || customer === void 0 ? void 0 : customer.id]);\n  useEffect(() => {\n    if (appliedVoucher && totalAmount > 0) {\n      let calculatedDiscount = 0;\n      if (appliedVoucher.phamTramGiamGia) {\n        calculatedDiscount = totalAmount * appliedVoucher.phamTramGiamGia / 100;\n        if (appliedVoucher.giamToiDa && calculatedDiscount > appliedVoucher.giamToiDa) {\n          calculatedDiscount = appliedVoucher.giamToiDa;\n        }\n      } else if (appliedVoucher.soTienGiam) {\n        calculatedDiscount = appliedVoucher.soTienGiam;\n      }\n      setDiscountValue(calculatedDiscount);\n    } else {\n      setDiscountValue(0);\n    }\n  }, [appliedVoucher, totalAmount]);\n  const handleApplyVoucher = async () => {\n    if (!voucherCode.trim()) {\n      setAppliedVoucher(suggestedVoucher);\n      setVoucherCode(suggestedVoucher ? suggestedVoucher.phieuGiamGia.maPhieuGiamGia : \"\");\n      toast.info(suggestedVoucher ? \"ƒê√£ quay v·ªÅ m√£ gi·∫£m gi√° t·ªët nh·∫•t!\" : \"ƒê√£ b·ªè √°p d·ª•ng m√£ gi·∫£m gi√°.\");\n      return;\n    }\n    if (!customer || !customer.id) {\n      toast.warn(\"Vui l√≤ng ch·ªçn kh√°ch h√†ng tr∆∞·ªõc khi √°p d·ª•ng m√£!\");\n      return;\n    }\n    try {\n      const response = await axios.get(\"http://localhost:8080/PhieuGiamGiaKhachHang/find-by-code\", {\n        params: {\n          maPhieu: voucherCode,\n          idKhachHang: customer.id\n        }\n      });\n      const foundVoucher = response.data.data;\n      if (totalAmount < foundVoucher.phieuGiamGia.dieuKienGiam) {\n        toast.error(`M√£ n√†y y√™u c·∫ßu h√≥a ƒë∆°n t·ªëi thi·ªÉu ${formatCurrency(foundVoucher.phieuGiamGia.dieuKienGiam)}!`);\n        return;\n      }\n      setAppliedVoucher(foundVoucher);\n      toast.success(`ƒê√£ √°p d·ª•ng th√†nh c√¥ng m√£: ${foundVoucher.phieuGiamGia.ma}`);\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      const errorMessage = ((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || \"M√£ gi·∫£m gi√° kh√¥ng h·ª£p l·ªá.\";\n      toast.error(errorMessage);\n      setAppliedVoucher(null);\n    }\n  };\n  const isDisabled = totalAmount <= 0;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Card, {\n      sx: {\n        height: \"100%\",\n        display: \"flex\",\n        flexDirection: \"column\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(SoftBox, {\n        p: 2,\n        sx: {\n          flexGrow: 1\n        },\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          spacing: 3,\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 12,\n            lg: 7,\n            children: [/*#__PURE__*/_jsxDEV(SoftBox, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 3,\n              children: [/*#__PURE__*/_jsxDEV(SoftTypography, {\n                variant: \"h5\",\n                fontWeight: \"bold\",\n                children: \"Kh\\xE1ch h\\xE0ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 641,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                display: \"flex\",\n                gap: 1,\n                children: [customer.id && /*#__PURE__*/_jsxDEV(SoftButton, {\n                  variant: \"outlined\",\n                  color: \"secondary\",\n                  startIcon: /*#__PURE__*/_jsxDEV(CloseIcon, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 650,\n                    columnNumber: 34\n                  }, this),\n                  onClick: handleClearCustomer,\n                  children: \"B\\u1ECE CH\\u1ECCN\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 647,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(SoftButton, {\n                  variant: \"outlined\",\n                  color: \"info\",\n                  startIcon: /*#__PURE__*/_jsxDEV(PersonSearchIcon, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 659,\n                    columnNumber: 32\n                  }, this),\n                  onClick: () => setIsCustomerModalOpen(true),\n                  children: \"CH\\u1ECCN KH\\xC1CH H\\xC0NG\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 656,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 645,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 640,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 3\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 666,\n              columnNumber: 15\n            }, this), isDelivery ? /*#__PURE__*/_jsxDEV(ShippingForm, {\n              initialCustomer: customer,\n              initialAddress: shippingAddress,\n              onOpenAddressModal: handleOpenAddressModal,\n              onFormChange: handleFormChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 669,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Box, {\n              children: [/*#__PURE__*/_jsxDEV(SoftTypography, {\n                variant: \"body1\",\n                color: \"text\",\n                fontWeight: \"medium\",\n                children: \"T\\xCAN KH\\xC1CH H\\xC0NG\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 677,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  p: 1.5,\n                  border: \"1px solid #ddd\",\n                  borderRadius: \"8px\",\n                  mt: 1\n                },\n                children: /*#__PURE__*/_jsxDEV(SoftTypography, {\n                  variant: \"h6\",\n                  children: customer.tenKhachHang\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 681,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 680,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 676,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 639,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 12,\n            lg: 5,\n            children: [/*#__PURE__*/_jsxDEV(FormControlLabel, {\n              control: /*#__PURE__*/_jsxDEV(Switch, {\n                checked: isDelivery,\n                onChange: handleDeliveryToggle\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 690,\n                columnNumber: 26\n              }, this),\n              label: /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Giao h\\xE0ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 691,\n                columnNumber: 24\n              }, this),\n              sx: {\n                mb: 2\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 689,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TextField, {\n              fullWidth: true,\n              label: \"Phi\\u1EBFu gi\\u1EA3m gi\\xE1\",\n              sx: {\n                mb: 3\n              },\n              value: voucherCode,\n              onChange: e => setVoucherCode(e.target.value),\n              helperText: appliedVoucher ? `ƒêang √°p d·ª•ng m√£ giaÃâm giaÃÅ t√¥ÃÅt nh√¢ÃÅt : ${appliedVoucher.maPhieuGiamGia}` : \"Nh·∫≠p m√£ gi·∫£m gi√° (n·∫øu c√≥)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 694,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(SoftBox, {\n              display: \"flex\",\n              flexDirection: \"column\",\n              gap: 2,\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body1\",\n                  children: \"Ti\\u1EC1n h\\xE0ng\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 709,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body1\",\n                  fontWeight: \"bold\",\n                  children: formatCurrency(totalAmount)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 710,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 708,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body1\",\n                  children: \"Ph\\xED v\\u1EADn chuy\\u1EC3n\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 716,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    width: \"150px\"\n                  },\n                  children: /*#__PURE__*/_jsxDEV(TextField, {\n                    variant: \"outlined\",\n                    size: \"small\",\n                    fullWidth: true,\n                    disabled: !isDelivery || isCalculatingFee // CHANGE: Disable when not delivery or calculating\n                    ,\n                    value: isCalculatingFee ? \"ƒêang t√≠nh...\" : shippingFeeInput // CHANGE: Bind to input state\n                    ,\n                    onChange: handleShippingFeeChange // CHANGE: Add change handler\n                    ,\n                    type: \"text\" // Use text to allow typing\n                    ,\n                    inputMode: \"numeric\" // Hint for numeric keyboard on mobile\n                    ,\n                    InputProps: {\n                      endAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n                        position: \"end\",\n                        children: \"\\u0111\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 728,\n                        columnNumber: 39\n                      }, this)\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 718,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 717,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 715,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body1\",\n                  children: \"Gi\\u1EA3m gi\\xE1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 734,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body1\",\n                  fontWeight: \"bold\",\n                  color: \"error\",\n                  children: [\"- \", formatCurrency(discountValue)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 735,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 733,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Divider, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 739,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h5\",\n                  fontWeight: \"bold\",\n                  children: \"T\\u1ED5ng ti\\u1EC1n\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 741,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h5\",\n                  fontWeight: \"bold\",\n                  color: \"error.main\",\n                  children: formatCurrency(finalTotal)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 744,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 740,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 707,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                display: \"flex\",\n                alignItems: \"center\",\n                gap: 1,\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  fontWeight: \"medium\",\n                  children: \"Kh\\xE1ch thanh to\\xE1n:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 751,\n                  columnNumber: 19\n                }, this), totalPaid < finalTotal && /*#__PURE__*/_jsxDEV(IconButton, {\n                  onClick: () => setIsPaymentModalOpen(true),\n                  sx: {\n                    border: \"1px solid #ddd\",\n                    borderRadius: \"8px\"\n                  },\n                  children: /*#__PURE__*/_jsxDEV(PaymentIcon, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 759,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 755,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 750,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                color: \"info.main\",\n                fontWeight: \"bold\",\n                children: formatCurrency(totalPaid)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 763,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 749,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                my: 3\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 767,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 688,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 637,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 636,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SoftBox, {\n        p: 2,\n        mt: \"auto\",\n        children: /*#__PURE__*/_jsxDEV(SoftButton, {\n          variant: \"outlined\",\n          size: \"medium\",\n          sx: {\n            borderRadius: 2,\n            textTransform: \"none\",\n            fontWeight: 400,\n            color: \"#49a3f1\",\n            borderColor: \"#49a3f1\",\n            boxShadow: \"none\",\n            \"&:hover\": {\n              borderColor: \"#1769aa\",\n              background: \"#f0f6fd\",\n              color: \"#1769aa\"\n            }\n          },\n          fullWidth: true,\n          disabled: isDisabled,\n          onClick: handleFinalSave,\n          children: /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            color: \"#49a3f1\",\n            fontWeight: \"bold\",\n            children: isDelivery ? \" ƒê·∫∂T H√ÄNG\" : \" THANH TO√ÅN\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 793,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 773,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 772,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 635,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: isCustomerModalOpen,\n      onClose: () => setIsCustomerModalOpen(false),\n      fullWidth: true,\n      maxWidth: \"lg\",\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          alignItems: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(SoftTypography, {\n            variant: \"h5\",\n            children: \"Ch\\u1ECDn kh\\xE1ch h\\xE0ng\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 809,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n            onClick: () => setIsCustomerModalOpen(false),\n            children: /*#__PURE__*/_jsxDEV(CloseIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 811,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 810,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 808,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 807,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        dividers: true,\n        children: /*#__PURE__*/_jsxDEV(CustomerTable, {\n          isSelectionMode: true,\n          onSelectCustomer: handleSelectCustomer\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 816,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 815,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 801,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AddressSelectionModal, {\n      open: isAddressModalOpen,\n      onClose: () => setIsAddressModalOpen(false),\n      addresses: addressList,\n      onSelectAddress: handleSelectAddressFromModal,\n      onOpenAddAddressModal: handleOpenAddModalFromSelectModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 819,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AddAddressModal, {\n      open: isAddAddressModalOpen,\n      onClose: () => setIsAddAddressModalOpen(false),\n      customerId: customer.id,\n      onAddressAdded: handleAddressAdded\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 826,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PaymentModal, {\n      open: isPaymentModalOpen,\n      onClose: () => setIsPaymentModalOpen(false),\n      totalAmount: finalTotal,\n      onConfirm: handleConfirmPayment,\n      hoaDonId: hoaDonId\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 832,\n      columnNumber: 7\n    }, this), invoiceToPrintId && /*#__PURE__*/_jsxDEV(InHoaDon, {\n      isOpen: isInvoiceModalOpen,\n      onClose: () => setIsInvoiceModalOpen(false),\n      hoaDonId: invoiceToPrintId\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 840,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n}\n_s(Pay, \"902qIAyfTLSD0NBXaxiHO5jcq28=\");\n_c = Pay;\nPay.defaultProps = {\n  totalAmount: 0\n};\nPay.propTypes = {\n  totalAmount: PropTypes.number,\n  hoaDonId: PropTypes.number,\n  onSaveOrder: PropTypes.func.isRequired,\n  onDataChange: PropTypes.func.isRequired,\n  completedOrderId: PropTypes.number\n};\nexport default Pay;\nvar _c;\n$RefreshReg$(_c, \"Pay\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","Box","Typography","Divider","TextField","Switch","FormControlLabel","Grid","Dialog","DialogTitle","DialogContent","IconButton","axios","SoftBox","SoftTypography","SoftButton","Card","PersonSearchIcon","CloseIcon","PropTypes","ShippingForm","CustomerTable","AddressSelectionModal","AddAddressModal","PaymentModal","CalculateIcon","InputAdornment","toast","InHoaDon","PaymentIcon","jsxDEV","_jsxDEV","Fragment","_Fragment","formatCurrency","amount","isNaN","Intl","NumberFormat","style","currency","format","formatNumber","value","Pay","totalAmount","hoaDonId","onSaveOrder","onDataChange","completedOrderId","_s","hoaDonDataRef","isDelivery","setIsDelivery","shippingFee","setShippingFee","discountValue","setDiscountValue","paymentDetails","setPaymentDetails","shippingFeeInput","setShippingFeeInput","isPaymentModalOpen","setIsPaymentModalOpen","voucherCode","setVoucherCode","appliedVoucher","setAppliedVoucher","suggestedVoucher","setSuggestedVoucher","bestidVoucher","setBestidVoucher","customer","setCustomer","id","tenKhachHang","isCustomerModalOpen","setIsCustomerModalOpen","shippingFormData","setShippingFormData","shippingAddress","setShippingAddress","finalTotal","amountOwed","Number","isAddressModalOpen","setIsAddressModalOpen","addressList","setAddressList","isAddAddressModalOpen","setIsAddAddressModalOpen","isCalculatingFee","setIsCalculatingFee","totalPaid","reduce","sum","p","soTienThanhToan","changeToCustomer","isInvoiceModalOpen","setIsInvoiceModalOpen","invoiceToPrintId","setInvoiceToPrintId","GHN_API_BASE_URL","GHN_TOKEN","ghnApi","create","baseURL","headers","token","getShippingFeeFromGHN","shippingInfo","shop_id","districtId","to_district_id","wardCode","to_ward_code","alternativeDistricts","district_id","ward_code","name","altDistrict","from_district_id","from_ward_code","console","log","_serviceResponse$data","_feeResponse$data","serviceResponse","get","params","from_district","to_district","data","length","selectedService","service_id","service_type_id","feePayload","height","weight","width","insurance_value","coupon","cod_failed_amount","feeResponse","post","ShopId","code","total","error","_error$response","_error$response$data","errorCode","response","code_message","_error$response2","estimatedFee","getEstimatedShippingFee","warning","feeRanges","hanoi_inner","hanoi_outer","major_cities","other_provinces","saveCurrentData","current","orderToClose","orders","find","o","idHoaDonBackend","handleCloseOrderTab","restoreData","savedData","resetToDefault","fetchBestVoucherForCustomer","handleShippingFeeChange","event","rawValue","target","numericValue","parseInt","replace","resetForm","handleOpenAddModalFromSelectModal","handleDeliveryToggle","isChecked","checked","handleFormChange","formData","handleFeeCalculation","fee","toString","dataToSend","phieuGiamGia","tongTienGiam","handleSelectCustomer","selectedCustomer","addresses","handleConfirmPayment","newPaymentsFromModal","savedPayments","payment","payload","idHoaDon","push","prevDetails","success","handleFinalSave","latestPaymentData","handleClearCustomer","handleOpenAddressModal","warn","handleSelectAddressFromModal","selectedAddress","handleAddressAdded","customerId","requestBody","khachHang","tongTienHoaDon","page","size","vouchers","content","bestVoucher","maPhieuGiamGia","calculatedDiscount","phamTramGiamGia","giamToiDa","soTienGiam","handleApplyVoucher","trim","info","maPhieu","idKhachHang","foundVoucher","dieuKienGiam","ma","_error$response3","_error$response3$data","errorMessage","message","isDisabled","children","sx","display","flexDirection","flexGrow","container","spacing","item","xs","lg","justifyContent","alignItems","mb","variant","fontWeight","fileName","_jsxFileName","lineNumber","columnNumber","gap","color","startIcon","onClick","initialCustomer","initialAddress","onOpenAddressModal","onFormChange","border","borderRadius","mt","control","onChange","label","fullWidth","e","helperText","disabled","type","inputMode","InputProps","endAdornment","position","my","textTransform","borderColor","boxShadow","background","open","onClose","maxWidth","dividers","isSelectionMode","onSelectCustomer","onSelectAddress","onOpenAddAddressModal","onAddressAdded","onConfirm","isOpen","_c","defaultProps","propTypes","number","func","isRequired","$RefreshReg$"],"sources":["D:/fashion-shirt-shop/DATN/src/main/resources/templates/fashionshop-ui/src/layouts/admin/BanHangTaiQuay/component/Pay.jsx"],"sourcesContent":["// src/layouts/BanHangTaiQuay/component/Pay.jsx\n\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport {\n  Box,\n  Typography,\n  Divider,\n  TextField,\n  Switch,\n  FormControlLabel,\n  Grid,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  IconButton,\n} from \"@mui/material\";\nimport axios from \"axios\";\n\n// Import components v√† icons\nimport SoftBox from \"../../../../components/SoftBox\";\nimport SoftTypography from \"../../../../components/SoftTypography\";\nimport SoftButton from \"../../../../components/SoftButton\";\nimport Card from \"@mui/material/Card\";\nimport PersonSearchIcon from \"@mui/icons-material/PersonSearch\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport PropTypes from \"prop-types\";\n// Import c√°c component con\nimport ShippingForm from \"./ShippingForm\";\nimport CustomerTable from \"./CustomerTable\";\nimport AddressSelectionModal from \"./AddressSelectionModal\";\nimport AddAddressModal from \"./AddAddressModal\";\nimport PaymentModal from \"./PaymentModal\";\nimport CalculateIcon from \"@mui/icons-material/Calculate\";\nimport { InputAdornment } from \"@mui/material\";\nimport { toast } from \"react-toastify\";\nimport InHoaDon from \"../../HoaDon/InHoaDon/InHoaDon\";\nimport PaymentIcon from \"@mui/icons-material/Payment\";\n// H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá\nconst formatCurrency = (amount) => {\n  if (typeof amount !== \"number\" || isNaN(amount)) return \"0 VND\";\n  return new Intl.NumberFormat(\"vi-VN\", { style: \"currency\", currency: \"VND\" }).format(amount);\n};\nconst formatNumber = (value) => {\n  if (!value) return \"\";\n  return new Intl.NumberFormat(\"vi-VN\").format(value);\n};\n\nfunction Pay({ totalAmount, hoaDonId, onSaveOrder, onDataChange, completedOrderId }) {\n  const hoaDonDataRef = useRef({});\n\n  const [isDelivery, setIsDelivery] = useState(false);\n  const [shippingFee, setShippingFee] = useState(0);\n  const [discountValue, setDiscountValue] = useState(0);\n  const [paymentDetails, setPaymentDetails] = useState([]);\n  const [shippingFeeInput, setShippingFeeInput] = useState(\"0\");\n  const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\n  const [voucherCode, setVoucherCode] = useState(\"\");\n  const [appliedVoucher, setAppliedVoucher] = useState(null);\n  const [suggestedVoucher, setSuggestedVoucher] = useState(null);\n  const [bestidVoucher, setBestidVoucher] = useState(null);\n\n  const [customer, setCustomer] = useState({ id: null, tenKhachHang: \"Kh√°ch l·∫ª\" });\n  const [isCustomerModalOpen, setIsCustomerModalOpen] = useState(false);\n  const [shippingFormData, setShippingFormData] = useState(null);\n  const [shippingAddress, setShippingAddress] = useState(null);\n\n  const finalTotal = totalAmount + (isDelivery ? shippingFee : 0) - discountValue;\n  const amountOwed = finalTotal - Number(customer || 0);\n\n  const [isAddressModalOpen, setIsAddressModalOpen] = useState(false);\n  const [addressList, setAddressList] = useState([]);\n  const [isAddAddressModalOpen, setIsAddAddressModalOpen] = useState(false);\n  const [isCalculatingFee, setIsCalculatingFee] = useState(false);\n  // T√≠nh to√°n ti·ªÅn d·ª±a tr√™n `paymentDetails`\n  const totalPaid = paymentDetails.reduce((sum, p) => sum + p.soTienThanhToan, 0);\n  const changeToCustomer = totalPaid - finalTotal;\n  const [isInvoiceModalOpen, setIsInvoiceModalOpen] = useState(false);\n  const [invoiceToPrintId, setInvoiceToPrintId] = useState(null);\n  const GHN_API_BASE_URL = \"https://online-gateway.ghn.vn/shiip/public-api\";\n  const GHN_TOKEN = \"03b71be1-6891-11f0-9e03-7626358ab3e0\";\n  const ghnApi = axios.create({\n    baseURL: GHN_API_BASE_URL,\n    headers: {\n      token: GHN_TOKEN,\n      \"Content-Type\": \"application/json\",\n    },\n  });\n  const getShippingFeeFromGHN = async (shippingInfo) => {\n    const shop_id = 5908591;\n    const { districtId: to_district_id, wardCode: to_ward_code } = shippingInfo;\n\n    if (!to_district_id || !to_ward_code) {\n      return 0;\n    }\n\n    // üî• GI·∫¢I PH√ÅP: Th·ª≠ nhi·ªÅu district kh√°c nhau trong H√† N·ªôi\n    const alternativeDistricts = [\n      // Th·ª≠ district g·ªëc tr∆∞·ªõc\n      { district_id: 1450, ward_code: \"217010\", name: \"C·∫ßu Gi·∫•y (G·ªëc)\" },\n      // Backup districts\n      { district_id: 1442, ward_code: \"21211\", name: \"Ba ƒê√¨nh\" },\n      { district_id: 1443, ward_code: \"21311\", name: \"Ho√†n Ki·∫øm\" },\n      { district_id: 1447, ward_code: \"21711\", name: \"ƒê·ªëng ƒêa\" },\n      { district_id: 1448, ward_code: \"21811\", name: \"Hai B√† Tr∆∞ng\" },\n      { district_id: 1451, ward_code: \"22111\", name: \"Thanh Xu√¢n\" },\n    ];\n\n    // Th·ª≠ t·ª´ng district cho ƒë·∫øn khi th√†nh c√¥ng\n    for (const altDistrict of alternativeDistricts) {\n      const from_district_id = altDistrict.district_id;\n      const from_ward_code = altDistrict.ward_code;\n\n      console.log(`üîÑ ƒêang th·ª≠: ${altDistrict.name} (${from_district_id})`);\n\n      try {\n        // B∆∞·ªõc 1: Ki·ªÉm tra d·ªãch v·ª• kh·∫£ d·ª•ng\n        const serviceResponse = await axios.get(\n          `${GHN_API_BASE_URL}/v2/shipping-order/available-services`,\n          {\n            params: {\n              shop_id: shop_id,\n              from_district: from_district_id,\n              to_district: to_district_id,\n            },\n            headers: {\n              token: GHN_TOKEN,\n              \"Content-Type\": \"application/json\",\n            },\n          }\n        );\n\n        if (!serviceResponse.data?.data || serviceResponse.data.data.length === 0) {\n          console.log(`‚ùå Kh√¥ng c√≥ d·ªãch v·ª• cho ${altDistrict.name}`);\n          continue;\n        }\n\n        // B∆∞·ªõc 2: T√≠nh ph√≠ v·∫≠n chuy·ªÉn\n        const selectedService = serviceResponse.data.data[0];\n        const service_id = selectedService.service_id;\n        const service_type_id = selectedService.service_type_id;\n\n        const feePayload = {\n          service_id: service_id,\n          service_type_id: service_type_id,\n          from_district_id: from_district_id,\n          from_ward_code: from_ward_code,\n          to_district_id: to_district_id,\n          to_ward_code: to_ward_code,\n          height: 20,\n          length: 30,\n          weight: 500,\n          width: 15,\n          insurance_value: 0,\n          coupon: null,\n          cod_failed_amount: 0,\n        };\n\n        const feeResponse = await axios.post(\n          `${GHN_API_BASE_URL}/v2/shipping-order/fee`,\n          feePayload,\n          {\n            headers: {\n              token: GHN_TOKEN,\n              ShopId: shop_id,\n              \"Content-Type\": \"application/json\",\n            },\n          }\n        );\n\n        if (feeResponse.data?.code === 200) {\n          console.log(`‚úÖ Th√†nh c√¥ng v·ªõi ${altDistrict.name}!`);\n          console.log(`üí∞ Ph√≠ v·∫≠n chuy·ªÉn: ${feeResponse.data.data.total} VND`);\n\n          // Th√¥ng b√°o cho user bi·∫øt ƒëang d√πng ƒë·ªãa ch·ªâ backup (n·∫øu kh√¥ng ph·∫£i district g·ªëc)\n          if (from_district_id !== 1450) {\n            // toast.info(`ƒêang s·ª≠ d·ª•ng ƒëi·ªÉm g·ª≠i t·∫°i ${altDistrict.name} ƒë·ªÉ t√≠nh ph√≠ v·∫≠n chuy·ªÉn.`);\n          }\n\n          return feeResponse.data.data.total;\n        }\n      } catch (error) {\n        const errorCode = error.response?.data?.code_message;\n        console.log(`‚ùå L·ªói v·ªõi ${altDistrict.name}: ${errorCode}`);\n\n        // N·∫øu kh√¥ng ph·∫£i l·ªói district invalid th√¨ d·ª´ng (c√≥ th·ªÉ l·ªói kh√°c)\n        if (errorCode !== \"SEND_DISTRICT_IS_INVALID\") {\n          console.error(\"L·ªói kh√¥ng ph·∫£i district invalid:\", error.response?.data);\n          break;\n        }\n        continue;\n      }\n    }\n\n    // üéØ FALLBACK: N·∫øu t·∫•t c·∫£ districts ƒë·ªÅu fail, d√πng ph√≠ ∆∞·ªõc t√≠nh\n    console.log(\"üîÑ T·∫•t c·∫£ districts ƒë·ªÅu fail, s·ª≠ d·ª•ng ph√≠ ∆∞·ªõc t√≠nh\");\n\n    const estimatedFee = getEstimatedShippingFee(to_district_id);\n    toast.warning(\n      `Kh√¥ng th·ªÉ t√≠nh ph√≠ ch√≠nh x√°c. S·ª≠ d·ª•ng ph√≠ ∆∞·ªõc t√≠nh: ${formatCurrency(estimatedFee)}`\n    );\n\n    return estimatedFee;\n  };\n\n  // H√†m t√≠nh ph√≠ ∆∞·ªõc t√≠nh d·ª±a tr√™n district ƒë√≠ch\n  const getEstimatedShippingFee = (to_district_id) => {\n    // Ph√≠ ∆∞·ªõc t√≠nh d·ª±a tr√™n kho·∫£ng c√°ch (c√≥ th·ªÉ customize)\n    const feeRanges = {\n      // N·ªôi th√†nh H√† N·ªôi (1442-1465)\n      hanoi_inner: 25000,\n      // Ngo·∫°i th√†nh H√† N·ªôi (1466-1490)\n      hanoi_outer: 35000,\n      // TP.HCM v√† c√°c th√†nh ph·ªë l·ªõn\n      major_cities: 45000,\n      // C√°c t·ªânh kh√°c\n      other_provinces: 55000,\n    };\n\n    if (to_district_id >= 1442 && to_district_id <= 1465) {\n      return feeRanges.hanoi_inner;\n    } else if (to_district_id >= 1466 && to_district_id <= 1490) {\n      return feeRanges.hanoi_outer;\n    } else if (to_district_id >= 1460 && to_district_id <= 1520) {\n      return feeRanges.major_cities;\n    } else {\n      return feeRanges.other_provinces;\n    }\n  };\n  // H√†m l∆∞u d·ªØ li·ªáu hi·ªán t·∫°i v√†o ref\n  const saveCurrentData = useCallback(() => {\n    if (hoaDonId) {\n      hoaDonDataRef.current[hoaDonId] = {\n        isDelivery,\n        shippingFee,\n        shippingFeeInput,\n        discountValue,\n\n        voucherCode,\n        appliedVoucher,\n        suggestedVoucher,\n        customer,\n        shippingFormData,\n        shippingAddress,\n        paymentDetails,\n      };\n    }\n  }, [\n    hoaDonId,\n    isDelivery,\n    shippingFee,\n    discountValue,\n    voucherCode,\n    shippingFeeInput,\n    appliedVoucher,\n    suggestedVoucher,\n    customer,\n    shippingFormData,\n    shippingAddress,\n    paymentDetails,\n  ]);\n\n  useEffect(() => {\n    if (completedOrderId) {\n      const orderToClose = orders.find((o) => o.idHoaDonBackend === completedOrderId);\n\n      if (orderToClose) {\n        handleCloseOrderTab(orderToClose.id);\n      }\n    }\n  }, [completedOrderId]);\n\n  const restoreData = useCallback(() => {\n    if (hoaDonId && hoaDonDataRef.current[hoaDonId]) {\n      const savedData = hoaDonDataRef.current[hoaDonId];\n      setIsDelivery(savedData.isDelivery);\n      setShippingFee(savedData.shippingFee);\n      setDiscountValue(savedData.discountValue);\n      setShippingFeeInput(savedData.shippingFeeInput || \"0\");\n      setVoucherCode(savedData.voucherCode);\n      setAppliedVoucher(savedData.appliedVoucher);\n      setSuggestedVoucher(savedData.suggestedVoucher);\n      setCustomer(savedData.customer);\n      setShippingFormData(savedData.shippingFormData);\n      setShippingAddress(savedData.shippingAddress);\n      setPaymentDetails(savedData.paymentDetails || []);\n    } else {\n      // Reset v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥ d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u\n      resetToDefault();\n\n      // Sau khi reset, g·ªçi API t√¨m voucher t·ªët nh·∫•t cho kh√°ch l·∫ª\n      if (totalAmount > 0) {\n        fetchBestVoucherForCustomer(null);\n      }\n    }\n  }, [hoaDonId, totalAmount]);\n\n  const resetToDefault = useCallback(() => {\n    setIsDelivery(false);\n    setShippingFee(0);\n    setDiscountValue(0);\n    setShippingFeeInput(\"0\");\n    setPaymentDetails([]);\n    setVoucherCode(\"\");\n    setAppliedVoucher(null);\n    setSuggestedVoucher(null);\n    setCustomer({ id: null, tenKhachHang: \"Kh√°ch l·∫ª\" });\n    setShippingFormData(null);\n    setShippingAddress(null);\n  }, []);\n\n  // Effect ƒë·ªÉ l∆∞u d·ªØ li·ªáu khi c√≥ thay ƒë·ªïi\n  useEffect(() => {\n    saveCurrentData();\n  }, [saveCurrentData]);\n\n  // Effect ƒë·ªÉ kh√¥i ph·ª•c d·ªØ li·ªáu khi chuy·ªÉn tab (hoaDonId thay ƒë·ªïi)\n  useEffect(() => {\n    if (hoaDonId) {\n      restoreData();\n    }\n  }, [hoaDonId, restoreData]);\n  // NEW FUNCTION: Handle manual input for shipping fee\n  const handleShippingFeeChange = (event) => {\n    const rawValue = event.target.value;\n    // Allow user to type, update the input state\n    setShippingFeeInput(rawValue);\n    // Parse the number from input and update the actual fee state\n    const numericValue = parseInt(rawValue.replace(/[^0-9]/g, \"\"), 10) || 0;\n    setShippingFee(numericValue);\n    if (rawValue) {\n      setShippingFeeInput(formatNumber(numericValue));\n    } else {\n      setShippingFeeInput(\"\"); // Cho ph√©p x√≥a h·∫øt ƒë·ªÉ nh·∫≠p l·∫°i\n    }\n  };\n  // H√†m reset form ho√†n to√†n (c√≥ th·ªÉ d√πng khi c·∫ßn thi·∫øt)\n  const resetForm = useCallback(() => {\n    if (hoaDonId) {\n      delete hoaDonDataRef.current[hoaDonId]; // X√≥a d·ªØ li·ªáu ƒë√£ l∆∞u\n    }\n    resetToDefault();\n  }, [hoaDonId, resetToDefault]);\n\n  const handleOpenAddModalFromSelectModal = () => {\n    setIsAddressModalOpen(false);\n    setIsAddAddressModalOpen(true);\n  };\n\n  const handleDeliveryToggle = (event) => {\n    const isChecked = event.target.checked;\n    setIsDelivery(isChecked);\n\n    if (!isChecked) {\n      setShippingFormData(null);\n      setShippingAddress(null);\n      setShippingFeeInput(\"0\");\n    }\n  };\n\n  const handleFormChange = useCallback((formData) => {\n    setShippingFormData(formData);\n  }, []);\n\n  useEffect(() => {\n    // Ch·ªâ t√≠nh ph√≠ khi b·∫≠t ch·∫ø ƒë·ªô giao h√†ng v√† c√≥ ƒë·ªß th√¥ng tin\n    if (isDelivery && shippingFormData && shippingFormData.wardCode) {\n      const handleFeeCalculation = async () => {\n        setIsCalculatingFee(true);\n        const fee = await getShippingFeeFromGHN(shippingFormData);\n        setShippingFee(fee);\n        setShippingFeeInput(fee.toString());\n        setIsCalculatingFee(false);\n      };\n      handleFeeCalculation();\n    }\n  }, [shippingFormData, isDelivery]);\n\n  useEffect(() => {\n    if (onDataChange) {\n      const dataToSend = {\n        customer,\n        isDelivery,\n        shippingFee,\n        shippingInfo: isDelivery ? shippingFormData : null,\n        phieuGiamGia: appliedVoucher,\n        tongTienGiam: discountValue,\n      };\n      onDataChange(dataToSend);\n    }\n  }, [customer, isDelivery, shippingFee, shippingFormData, onDataChange, paymentDetails]);\n\n  const handleSelectCustomer = async (selectedCustomer) => {\n    setCustomer(selectedCustomer);\n\n    // Reset voucher khi thay ƒë·ªïi kh√°ch h√†ng\n    setVoucherCode(\"\");\n    setAppliedVoucher(null);\n    setSuggestedVoucher(null);\n    setDiscountValue(0);\n\n    try {\n      const response = await axios.get(\n        `http://localhost:8080/diaChi/khachhang/${selectedCustomer.id}`\n      );\n      const addresses = response.data;\n      if (addresses && addresses.length > 0) {\n        setShippingAddress(addresses[0]);\n      } else {\n        setShippingAddress(null);\n      }\n    } catch (error) {\n      console.error(\"L·ªói khi l·∫•y danh s√°ch ƒë·ªãa ch·ªâ:\", error);\n      setShippingAddress(null);\n    }\n\n    // G·ªçi API ƒë·ªÉ t√¨m phi·∫øu gi·∫£m gi√° t·ªët nh·∫•t cho kh√°ch h√†ng m·ªõi\n    if (totalAmount > 0) {\n      await fetchBestVoucherForCustomer(selectedCustomer.id);\n    }\n\n    setIsCustomerModalOpen(false);\n  };\n\n  const handleConfirmPayment = async (newPaymentsFromModal) => {\n    if (!newPaymentsFromModal || newPaymentsFromModal.length === 0) {\n      setIsPaymentModalOpen(false);\n      return;\n    }\n\n    try {\n      const savedPayments = [];\n      for (const payment of newPaymentsFromModal) {\n        const payload = { ...payment, idHoaDon: hoaDonId };\n        const response = await axios.post(\"http://localhost:8080/chiTietThanhToan\", payload);\n        savedPayments.push(response.data.data);\n      }\n\n      setPaymentDetails((prevDetails) => [...prevDetails, ...savedPayments]);\n      toast.success(\"Thanh toaÃÅn th√†nh c√¥ng!\");\n      setIsPaymentModalOpen(false);\n    } catch (error) {\n      console.error(\"L·ªói trong qu√° tr√¨nh thanh to√°n:\", error);\n    }\n  };\n\n  const handleFinalSave = async () => {\n    if (!isDelivery) {\n      const totalPaid = paymentDetails.reduce((sum, p) => sum + p.soTienThanhToan, 0);\n\n      if (totalPaid < finalTotal) {\n        toast.error(\n          `Thanh to√°n ch∆∞a ƒë·ªß! Kh√°ch h√†ng c·∫ßn tr·∫£ th√™m ${formatCurrency(\n            finalTotal - totalPaid\n          )}. Vui l√≤ng ho√†n t·∫•t thanh to√°n.`\n        );\n\n        return;\n      }\n    }\n\n    const latestPaymentData = {\n      customer: customer,\n      isDelivery: isDelivery,\n      shippingFee: shippingFee,\n      shippingInfo: isDelivery ? shippingFormData : null,\n      phieuGiamGia: appliedVoucher,\n      tongTienGiam: discountValue,\n    };\n    console.log(\"D·ªØ li·ªáu thanh to√°n m·ªõi:\", latestPaymentData);\n    try {\n      // ƒê·ª£i cho ƒë·∫øn khi vi·ªác l∆∞u ƒë∆°n h√†ng ho√†n t·∫•t\n      await onSaveOrder(latestPaymentData);\n\n      // --- LOGIC M·ªöI ƒê·ªÇ IN H√ìA ƒê∆†N ---\n      // Ch·ªâ m·ªü modal in n·∫øu l√† thanh to√°n t·∫°i qu·∫ßy\n      if (!isDelivery) {\n        setInvoiceToPrintId(hoaDonId); // L∆∞u l·∫°i ID h√≥a ƒë∆°n v·ª´a thanh to√°n\n        setIsInvoiceModalOpen(true); // M·ªü modal in\n      }\n      resetForm();\n    } catch (error) {\n      console.error(\"L·ªói khi l∆∞u v√† in h√≥a ƒë∆°n:\", error);\n      // B·∫°n c√≥ th·ªÉ th√™m toast th√¥ng b√°o l·ªói ·ªü ƒë√¢y n·∫øu c·∫ßn\n    }\n\n    // resetForm(); // B·ªè comment d√≤ng n√†y n·∫øu mu·ªën reset sau khi l∆∞u\n  };\n\n  const handleClearCustomer = async () => {\n    setCustomer({ id: null, tenKhachHang: \"Kh√°ch l·∫ª\" });\n    setShippingAddress(null);\n\n    // Reset voucher khi b·ªè ch·ªçn kh√°ch h√†ng\n    setVoucherCode(\"\");\n    setAppliedVoucher(null);\n    setSuggestedVoucher(null);\n    setDiscountValue(0);\n\n    // G·ªçi API ƒë·ªÉ t√¨m phi·∫øu gi·∫£m gi√° cho kh√°ch l·∫ª (null)\n    if (totalAmount > 0) {\n      await fetchBestVoucherForCustomer(null);\n    }\n  };\n\n  const handleOpenAddressModal = async () => {\n    if (!customer || !customer.id) {\n      toast.warn(\"Vui l√≤ng ch·ªçn m·ªôt kh√°ch h√†ng tr∆∞·ªõc.\");\n      return;\n    }\n\n    try {\n      const response = await axios.get(\n        `http://localhost:8080/diaChi/khachhang/${customer.id}`\n      );\n      setAddressList(response.data || []);\n      setIsAddressModalOpen(true);\n    } catch (error) {\n      console.error(\"L·ªói khi l·∫•y danh s√°ch ƒë·ªãa ch·ªâ:\", error);\n      setAddressList([]);\n      setIsAddressModalOpen(true);\n    }\n  };\n\n  const handleSelectAddressFromModal = (selectedAddress) => {\n    setShippingAddress(selectedAddress);\n    setIsAddressModalOpen(false);\n  };\n\n  const handleAddressAdded = () => {\n    setIsAddAddressModalOpen(false);\n    handleOpenAddressModal();\n  };\n\n  // T√°ch ri√™ng h√†m fetch voucher ƒë·ªÉ t√°i s·ª≠ d·ª•ng\n  const fetchBestVoucherForCustomer = async (customerId) => {\n    try {\n      const requestBody = {\n        khachHang: customerId,\n        tongTienHoaDon: totalAmount,\n      };\n      const response = await axios.post(\n        \"http://localhost:8080/PhieuGiamGiaKhachHang/query\",\n        requestBody,\n        { params: { page: 0, size: 999 } }\n      );\n\n      const vouchers = response.data.data.content;\n      if (vouchers && vouchers.length > 0) {\n        const bestVoucher = vouchers[0];\n        setSuggestedVoucher(bestVoucher);\n        setAppliedVoucher(bestVoucher);\n        setVoucherCode(bestVoucher.maPhieuGiamGia);\n      } else {\n        setSuggestedVoucher(null);\n        setAppliedVoucher(null);\n        setVoucherCode(\"\");\n      }\n    } catch (error) {\n      console.error(\"L·ªói khi t√¨m phi·∫øu gi·∫£m gi√° g·ª£i √Ω:\", error);\n      setSuggestedVoucher(null);\n      setAppliedVoucher(null);\n      setVoucherCode(\"\");\n    }\n  };\n\n  useEffect(() => {\n    if (totalAmount > 0) {\n      fetchBestVoucherForCustomer(customer.id);\n    } else {\n      setSuggestedVoucher(null);\n      setAppliedVoucher(null);\n      setVoucherCode(\"\");\n    }\n  }, [totalAmount, customer?.id]);\n\n  useEffect(() => {\n    if (appliedVoucher && totalAmount > 0) {\n      let calculatedDiscount = 0;\n\n      if (appliedVoucher.phamTramGiamGia) {\n        calculatedDiscount = (totalAmount * appliedVoucher.phamTramGiamGia) / 100;\n        if (appliedVoucher.giamToiDa && calculatedDiscount > appliedVoucher.giamToiDa) {\n          calculatedDiscount = appliedVoucher.giamToiDa;\n        }\n      } else if (appliedVoucher.soTienGiam) {\n        calculatedDiscount = appliedVoucher.soTienGiam;\n      }\n      setDiscountValue(calculatedDiscount);\n    } else {\n      setDiscountValue(0);\n    }\n  }, [appliedVoucher, totalAmount]);\n\n  const handleApplyVoucher = async () => {\n    if (!voucherCode.trim()) {\n      setAppliedVoucher(suggestedVoucher);\n      setVoucherCode(suggestedVoucher ? suggestedVoucher.phieuGiamGia.maPhieuGiamGia : \"\");\n      toast.info(\n        suggestedVoucher ? \"ƒê√£ quay v·ªÅ m√£ gi·∫£m gi√° t·ªët nh·∫•t!\" : \"ƒê√£ b·ªè √°p d·ª•ng m√£ gi·∫£m gi√°.\"\n      );\n      return;\n    }\n\n    if (!customer || !customer.id) {\n      toast.warn(\"Vui l√≤ng ch·ªçn kh√°ch h√†ng tr∆∞·ªõc khi √°p d·ª•ng m√£!\");\n      return;\n    }\n\n    try {\n      const response = await axios.get(\"http://localhost:8080/PhieuGiamGiaKhachHang/find-by-code\", {\n        params: { maPhieu: voucherCode, idKhachHang: customer.id },\n      });\n      const foundVoucher = response.data.data;\n\n      if (totalAmount < foundVoucher.phieuGiamGia.dieuKienGiam) {\n        toast.error(\n          `M√£ n√†y y√™u c·∫ßu h√≥a ƒë∆°n t·ªëi thi·ªÉu ${formatCurrency(\n            foundVoucher.phieuGiamGia.dieuKienGiam\n          )}!`\n        );\n        return;\n      }\n      setAppliedVoucher(foundVoucher);\n      toast.success(`ƒê√£ √°p d·ª•ng th√†nh c√¥ng m√£: ${foundVoucher.phieuGiamGia.ma}`);\n    } catch (error) {\n      const errorMessage = error.response?.data?.message || \"M√£ gi·∫£m gi√° kh√¥ng h·ª£p l·ªá.\";\n      toast.error(errorMessage);\n      setAppliedVoucher(null);\n    }\n  };\n  const isDisabled = totalAmount <= 0;\n  return (\n    <>\n      {/* Th·∫ª Card l√† th·∫ª bao b·ªçc ch√≠nh cho to√†n b·ªô giao di·ªán */}\n      <Card sx={{ height: \"100%\", display: \"flex\", flexDirection: \"column\" }}>\n        <SoftBox p={2} sx={{ flexGrow: 1 }}>\n          <Grid container spacing={3}>\n            {/* C·ªòT TR√ÅI */}\n            <Grid item xs={12} lg={7}>\n              <SoftBox display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={3}>\n                <SoftTypography variant=\"h5\" fontWeight=\"bold\">\n                  Kh√°ch h√†ng\n                </SoftTypography>\n\n                <Box display=\"flex\" gap={1}>\n                  {customer.id && (\n                    <SoftButton\n                      variant=\"outlined\"\n                      color=\"secondary\"\n                      startIcon={<CloseIcon />}\n                      onClick={handleClearCustomer}\n                    >\n                      B·ªé CH·ªåN\n                    </SoftButton>\n                  )}\n                  <SoftButton\n                    variant=\"outlined\"\n                    color=\"info\"\n                    startIcon={<PersonSearchIcon />}\n                    onClick={() => setIsCustomerModalOpen(true)}\n                  >\n                    CH·ªåN KH√ÅCH H√ÄNG\n                  </SoftButton>\n                </Box>\n              </SoftBox>\n              <Divider sx={{ mb: 3 }} />\n\n              {isDelivery ? (\n                <ShippingForm\n                  initialCustomer={customer}\n                  initialAddress={shippingAddress}\n                  onOpenAddressModal={handleOpenAddressModal}\n                  onFormChange={handleFormChange}\n                />\n              ) : (\n                <Box>\n                  <SoftTypography variant=\"body1\" color=\"text\" fontWeight=\"medium\">\n                    T√äN KH√ÅCH H√ÄNG\n                  </SoftTypography>\n                  <Box sx={{ p: 1.5, border: \"1px solid #ddd\", borderRadius: \"8px\", mt: 1 }}>\n                    <SoftTypography variant=\"h6\">{customer.tenKhachHang}</SoftTypography>\n                  </Box>\n                </Box>\n              )}\n            </Grid>\n\n            {/* C·ªòT PH·∫¢I (Thanh to√°n) */}\n            <Grid item xs={12} lg={5}>\n              <FormControlLabel\n                control={<Switch checked={isDelivery} onChange={handleDeliveryToggle} />}\n                label={<Typography variant=\"h6\">Giao h√†ng</Typography>}\n                sx={{ mb: 2 }}\n              />\n              <TextField\n                fullWidth\n                label=\"Phi·∫øu gi·∫£m gi√°\"\n                sx={{ mb: 3 }}\n                value={voucherCode}\n                onChange={(e) => setVoucherCode(e.target.value)}\n                helperText={\n                  appliedVoucher\n                    ? `ƒêang √°p d·ª•ng m√£ giaÃâm giaÃÅ t√¥ÃÅt nh√¢ÃÅt : ${appliedVoucher.maPhieuGiamGia}`\n                    : \"Nh·∫≠p m√£ gi·∫£m gi√° (n·∫øu c√≥)\"\n                }\n              />\n\n              <SoftBox display=\"flex\" flexDirection=\"column\" gap={2}>\n                <Box display=\"flex\" justifyContent=\"space-between\">\n                  <Typography variant=\"body1\">Ti·ªÅn h√†ng</Typography>\n                  <Typography variant=\"body1\" fontWeight=\"bold\">\n                    {formatCurrency(totalAmount)}\n                  </Typography>\n                </Box>\n                {/* --- MODIFIED: Hi·ªÉn th·ªã ph√≠ ship ƒë·ªông v√† cho ph√©p nh·∫≠p li·ªáu --- */}\n                <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\n                  <Typography variant=\"body1\">Ph√≠ v·∫≠n chuy·ªÉn</Typography>\n                  <Box sx={{ width: \"150px\" }}>\n                    <TextField\n                      variant=\"outlined\"\n                      size=\"small\"\n                      fullWidth\n                      disabled={!isDelivery || isCalculatingFee} // CHANGE: Disable when not delivery or calculating\n                      value={isCalculatingFee ? \"ƒêang t√≠nh...\" : shippingFeeInput} // CHANGE: Bind to input state\n                      onChange={handleShippingFeeChange} // CHANGE: Add change handler\n                      type=\"text\" // Use text to allow typing\n                      inputMode=\"numeric\" // Hint for numeric keyboard on mobile\n                      InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">ƒë</InputAdornment>,\n                      }}\n                    />\n                  </Box>\n                </Box>\n                <Box display=\"flex\" justifyContent=\"space-between\">\n                  <Typography variant=\"body1\">Gi·∫£m gi√°</Typography>\n                  <Typography variant=\"body1\" fontWeight=\"bold\" color=\"error\">\n                    - {formatCurrency(discountValue)}\n                  </Typography>\n                </Box>\n                <Divider />\n                <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\n                  <Typography variant=\"h5\" fontWeight=\"bold\">\n                    T·ªïng ti·ªÅn\n                  </Typography>\n                  <Typography variant=\"h5\" fontWeight=\"bold\" color=\"error.main\">\n                    {formatCurrency(finalTotal)}\n                  </Typography>\n                </Box>\n              </SoftBox>\n              <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\n                <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                  <Typography variant=\"h6\" fontWeight=\"medium\">\n                    Kh√°ch thanh to√°n:\n                  </Typography>\n                  {totalPaid < finalTotal && (\n                    <IconButton\n                      onClick={() => setIsPaymentModalOpen(true)}\n                      sx={{ border: \"1px solid #ddd\", borderRadius: \"8px\" }}\n                    >\n                      <PaymentIcon />\n                    </IconButton>\n                  )}\n                </Box>\n                <Typography variant=\"h6\" color=\"info.main\" fontWeight=\"bold\">\n                  {formatCurrency(totalPaid)}\n                </Typography>\n              </Box>\n              <Divider sx={{ my: 3 }} />\n            </Grid>\n          </Grid>\n        </SoftBox>\n\n        <SoftBox p={2} mt=\"auto\">\n          <SoftButton\n            variant=\"outlined\"\n            size=\"medium\"\n            sx={{\n              borderRadius: 2,\n              textTransform: \"none\",\n              fontWeight: 400,\n              color: \"#49a3f1\",\n              borderColor: \"#49a3f1\",\n              boxShadow: \"none\",\n              \"&:hover\": {\n                borderColor: \"#1769aa\",\n                background: \"#f0f6fd\",\n                color: \"#1769aa\",\n              },\n            }}\n            fullWidth\n            disabled={isDisabled}\n            onClick={handleFinalSave}\n          >\n            <Typography variant=\"h6\" color=\"#49a3f1\" fontWeight=\"bold\">\n              {isDelivery ? \" ƒê·∫∂T H√ÄNG\" : \" THANH TO√ÅN\"}\n            </Typography>\n          </SoftButton>\n        </SoftBox>\n      </Card>\n\n      {/* MODAL CH·ªåN KH√ÅCH H√ÄNG */}\n      <Dialog\n        open={isCustomerModalOpen}\n        onClose={() => setIsCustomerModalOpen(false)}\n        fullWidth\n        maxWidth=\"lg\"\n      >\n        <DialogTitle>\n          <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\n            <SoftTypography variant=\"h5\">Ch·ªçn kh√°ch h√†ng</SoftTypography>\n            <IconButton onClick={() => setIsCustomerModalOpen(false)}>\n              <CloseIcon />\n            </IconButton>\n          </Box>\n        </DialogTitle>\n        <DialogContent dividers>\n          <CustomerTable isSelectionMode={true} onSelectCustomer={handleSelectCustomer} />\n        </DialogContent>\n      </Dialog>\n      <AddressSelectionModal\n        open={isAddressModalOpen}\n        onClose={() => setIsAddressModalOpen(false)}\n        addresses={addressList}\n        onSelectAddress={handleSelectAddressFromModal}\n        onOpenAddAddressModal={handleOpenAddModalFromSelectModal}\n      />\n      <AddAddressModal\n        open={isAddAddressModalOpen}\n        onClose={() => setIsAddAddressModalOpen(false)}\n        customerId={customer.id}\n        onAddressAdded={handleAddressAdded}\n      />\n      <PaymentModal\n        open={isPaymentModalOpen}\n        onClose={() => setIsPaymentModalOpen(false)}\n        totalAmount={finalTotal}\n        onConfirm={handleConfirmPayment}\n        hoaDonId={hoaDonId}\n      />\n      {invoiceToPrintId && (\n        <InHoaDon\n          isOpen={isInvoiceModalOpen}\n          onClose={() => setIsInvoiceModalOpen(false)}\n          hoaDonId={invoiceToPrintId}\n        />\n      )}\n    </>\n  );\n}\n\nPay.defaultProps = {\n  totalAmount: 0,\n};\n\nPay.propTypes = {\n  totalAmount: PropTypes.number,\n  hoaDonId: PropTypes.number,\n  onSaveOrder: PropTypes.func.isRequired,\n  onDataChange: PropTypes.func.isRequired,\n  completedOrderId: PropTypes.number,\n};\n\nexport default Pay;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}